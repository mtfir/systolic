`timescale 1ns / 1ps

module systolic_6x6_tb;

    localparam T_CLK = 10;
    localparam WIDTH = 16;
    localparam FRAC_BIT = 10;
    
    reg clk, rst_n, en, clr;

    reg signed [WIDTH-1:0] a0, a1, a2, a3, a4, a5;
    reg signed [WIDTH-1:0] b00, b01, b02, b03, b04, b05;
    reg signed [WIDTH-1:0] b10, b11, b12, b13, b14, b15;
    reg signed [WIDTH-1:0] b20, b21, b22, b23, b24, b25;
    reg signed [WIDTH-1:0] b30, b31, b32, b33, b34, b35;
    reg signed [WIDTH-1:0] b40, b41, b42, b43, b44, b45;
    reg signed [WIDTH-1:0] b50, b51, b52, b53, b54, b55;

    wire signed [WIDTH-1:0] y0, y1, y2, y3, y4, y5;

    systolic_6x6 #(
        .WIDTH(WIDTH), .FRAC_BIT(FRAC_BIT)
    ) systolic_6x6_inst (
        .clk(clk), .rst_n(rst_n), .en(en), .clr(clr),
        .a0(a0), .a1(a1), .a2(a2), .a3(a3), .a4(a4), .a5(a5),
        .b00(b00), .b01(b01), .b02(b02), .b03(b03), .b04(b04), .b05(b05),
        .b10(b10), .b11(b11), .b12(b12), .b13(b13), .b14(b14), .b15(b15),
        .b20(b20), .b21(b21), .b22(b22), .b23(b23), .b24(b24), .b25(b25),
        .b30(b30), .b31(b31), .b32(b32), .b33(b33), .b34(b34), .b35(b35),
        .b40(b40), .b41(b41), .b42(b42), .b43(b43), .b44(b44), .b45(b45),
        .b50(b50), .b51(b51), .b52(b52), .b53(b53), .b54(b54), .b55(b55),
        .y0(y0), .y1(y1), .y2(y2), .y3(y3), .y4(y4), .y5(y5)
    );

    always begin
        clk = 0;
        #(T_CLK/2);
        clk = 1;
        #(T_CLK/2);
    end

    initial begin
        // Inisialisasi sinyal
        clk = 0; rst_n = 0; en = 0; clr = 0;

        a0 = 0; a1 = 0; a2 = 0; a3 = 0; a4 = 0; a5 = 0;
        b00 = 0; b01 = 0; b02 = 0; b03 = 0; b04 = 0; b05 = 0;
        b10 = 0; b11 = 0; b12 = 0; b13 = 0; b14 = 0; b15 = 0; 
        b20 = 0; b21 = 0; b22 = 0; b23 = 0; b24 = 0; b25 = 0;  
        b30 = 0; b31 = 0; b32 = 0; b33 = 0; b34 = 0; b35 = 0;
        b40 = 0; b41 = 0; b42 = 0; b43 = 0; b44 = 0; b45 = 0;
        b50 = 0; b51 = 0; b52 = 0; b53 = 0; b54 = 0; b55 = 0;
        #(T_CLK);

        // Reset sistem
        rst_n = 1; clr = 1;
        #(T_CLK);

        clr = 0; en = 1;

        a0 = 16'hFB33; /* -1.2 */ a1 = 16'h0533; /* 1.3 */ a2 = 16'h06CC; /* 1.7 */
        a3 = 16'hFACC; /* -1.3 */ a4 = 16'hFACC; /* -1.3 */ a5 = 16'h0000; /* 0.0 */

        b00 = 16'h0800; /* 2.0 */ b01 = 16'h1C00; /* 7.0 */ b02 = 16'h1800; /* 6.0 */
        b03 = 16'h0C00; /* 3.0 */ b04 = 16'h1800; /* 6.0 */ b05 = 16'h0C00; /* 3.0 */

        b10 = 16'h2800; /* 10.0 */ b11 = 16'h0800; /* 2.0 */ b12 = 16'h2000; /* 8.0 */
        b13 = 16'h2800; /* 10.0 */ b14 = 16'h2400; /* 9.0 */ b15 = 16'h0800; /* 2.0 */

        b20 = 16'h1400; /* 5.0 */ b21 = 16'h0C00; /* 3.0 */ b22 = 16'h0400; /* 1.0 */
        b23 = 16'h0C00; /* 3.0 */ b24 = 16'h1400; /* 5.0 */ b25 = 16'h1800; /* 6.0 */

        b30 = 16'h0C00; /* 3.0 */ b31 = 16'h0C00; /* 3.0 */ b32 = 16'h1800; /* 6.0 */
        b33 = 16'h0400; /* 1.0 */ b34 = 16'h1800; /* 6.0 */ b35 = 16'h2800; /* 10.0 */

        b40 = 16'h0400; /* 1.0 */ b41 = 16'h0400; /* 1.0 */ b42 = 16'h0400; /* 1.0 */
        b43 = 16'h0400; /* 1.0 */ b44 = 16'h0400; /* 1.0 */ b45 = 16'h0400; /* 1.0 */

        b50 = 16'h0000; /* 0.0 */ b51 = 16'h0000; /* 0.0 */ b52 = 16'h0000; /* 0.0 */
        b53 = 16'h0000; /* 0.0 */ b54 = 16'h0000; /* 0.0 */ b55 = 16'h0000; /* 0.0 */

        #(T_CLK);

        a0 = 16'h0133; /* 0.3 */ a1 = 16'h0200; /* 0.5 */ a2 = 16'h00CC; /* 0.2 */
        a3 = 16'h0400; /* 1.0 */ a4 = 16'hFC00; /* -1.0 */ a5 = 16'h0000; /* 0.0 */

        #(T_CLK);

        a0 = 16'h0266; /* 0.6 */ a1 = 16'h0066; /* 0.1 */ a2 = 16'h0333; /* 0.8 */
        a3 = 16'h0600; /* 1.5 */ a4 = 16'hFC00; /* -1.0 */ a5 = 16'h0000; /* 0.0 */

        #(T_CLK);

        a0 = 16'h0533; /* 1.3 */ a1 = 16'hFB33; /* -1.2 */ a2 = 16'hFA66; /* -1.4 */
        a3 = 16'h0533; /* 1.3 */ a4 = 16'hFC66; /* -0.9 */ a5 = 16'h0000; /* 0.0 */

        #(T_CLK);

        a0 = 16'h0533; /* 1.3 */ a1 = 16'h0133; /* 0.3 */ a2 = 16'h0200; /* 0.5 */
        a3 = 16'h0199; /* 0.4 */ a4 = 16'hFC00; /* -1.0 */ a5 = 16'h0000; /* 0.0 */

        #(T_CLK);

        a0 = 16'h0000; /* 0.0 */ a1 = 16'h0000; /* 0.0 */ a2 = 16'h0000; /* 0.0 */
        a3 = 16'h0000; /* 0.0 */ a4 = 16'h0000; /* 0.0 */ a5 = 16'h0000; /* 0.0 */

        #(T_CLK);

        a0 = 16'h0000; /* 0.0 */ a1 = 16'h0000; /* 0.0 */ a2 = 16'h0000; /* 0.0 */
        a3 = 16'h0000; /* 0.0 */ a4 = 16'h0000; /* 0.0 */ a5 = 16'h0000; /* 0.0 */

        #(T_CLK * 12);

        // Nonaktifkan enable
        en = 0;
        #(T_CLK);
        
        $stop;
    end

endmodule